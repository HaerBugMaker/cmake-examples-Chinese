
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>2.1 使用子工程CMake · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    
    <link rel="prev" href="../" />
    

    <style>
    @media only screen and (max-width: 640px) {
        .book-header .hidden-mobile {
            display: none;
        }
    }
    </style>
    <script>
        window["gitbook-plugin-github-buttons"] = {"buttons":[{"user":"SFUMECJF","repo":"cmake-examples-Chinese","type":"star","size":"large"},{"user":"SFUMECJF","type":"follow","width":"230","count":false}]};
    </script>

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    前言
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../../01-basic/">
            
                <a href="../../01-basic/">
            
                    
                    1  基本例程
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../../01-basic/1.1  hello-cmake.html">
            
                <a href="../../01-basic/1.1  hello-cmake.html">
            
                    
                    1.1  hello-CMake
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../../01-basic/1.2  hello-headers.html">
            
                <a href="../../01-basic/1.2  hello-headers.html">
            
                    
                    1.2  包含头文件
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../../01-basic/1.3  Static Library.html">
            
                <a href="../../01-basic/1.3  Static Library.html">
            
                    
                    1.3  包含静态库
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../../01-basic/1.4  Shared Library.html">
            
                <a href="../../01-basic/1.4  Shared Library.html">
            
                    
                    1.4  包含动态库
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="../../01-basic/1.5  build-type.html">
            
                <a href="../../01-basic/1.5  build-type.html">
            
                    
                    1.5  设置构建类型
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6" data-path="../../01-basic/1.6  Compile Flags.html">
            
                <a href="../../01-basic/1.6  Compile Flags.html">
            
                    
                    1.6  设置编译方式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7" data-path="../../01-basic/1.7  Including Third Party Library.html">
            
                <a href="../../01-basic/1.7  Including Third Party Library.html">
            
                    
                    1.7  包含第三方库
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.8" data-path="../../01-basic/I-compiling-with-clang/">
            
                <a href="../../01-basic/I-compiling-with-clang/">
            
                    
                    1.8  使用clang编译工程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.9" data-path="../../01-basic/J-building-with-ninja/">
            
                <a href="../../01-basic/J-building-with-ninja/">
            
                    
                    1.9  使用ninja构建工程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.10" data-path="../../01-basic/K-imported-targets/">
            
                <a href="../../01-basic/K-imported-targets/">
            
                    
                    1.10  导入目标
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.11" data-path="../../01-basic/L-cpp-standard/">
            
                <a href="../../01-basic/L-cpp-standard/">
            
                    
                    1.11 C++标准
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    2  子目录中使用多个CMake文件
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../">
            
                <a href="../">
            
                    
                    介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.3.2" data-path="./">
            
                <a href="./">
            
                    
                    2.1 使用子工程CMake
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    3  生成源代码
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../../03-code-generation/">
            
                <a href="../../03-code-generation/">
            
                    
                    介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../../03-code-generation/configure-files/">
            
                <a href="../../03-code-generation/configure-files/">
            
                    
                    3.1  配置文件
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../../03-code-generation/protobuf/">
            
                <a href="../../03-code-generation/protobuf/">
            
                    
                    3.2  protobuf
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >2.1 使用子工程CMake</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="basic-sub-project">Basic Sub-Project</h1>
<div id="preamble">
<div class="sectionbody">
<div id="toc" class="toc">
<div id="toctitle" class="title">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">Introduction</a></li>
<li><a href="#_concepts">Concepts</a></li>
<li><a href="#_adding_a_sub_directory">Adding a Sub-Directory</a></li>
<li><a href="#_referencing_sub_project_directories">Referencing Sub-Project Directories&#x5F15;&#x7528;&#x5B50;&#x9879;&#x76EE;&#x76EE;&#x5F55;</a></li>
<li><a href="#_header_only_libraries">Header only Libraries</a></li>
<li><a href="#_referencing_libraries_from_sub_projects">Referencing Libraries from Sub-Projects&#x5F15;&#x7528;&#x5B50;&#x9879;&#x76EE;&#x4E2D;&#x7684;&#x5E93;</a></li>
<li><a href="#_include_directories_from_sub_projects">Include directories from sub-projects&#x5305;&#x542B;&#x5B50;&#x9879;&#x76EE;&#x4E2D;&#x7684;&#x76EE;&#x5F55;</a></li>
<li><a href="#_building_the_example">Building the example</a></li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This example shows how to setup a CMake project that includes sub-projects. The
top level CMakeLists.txt calls the CMakeLists.txt in the sub directories to
create the following:&#x672C;&#x793A;&#x4F8B;&#x8BF4;&#x660E;&#x5982;&#x4F55;&#x8BBE;&#x7F6E;&#x5305;&#x542B;&#x5B50;&#x9879;&#x76EE;&#x7684;CMake&#x9879;&#x76EE;&#x3002; &#x9876;&#x7EA7;CMakeLists.txt&#x8C03;&#x7528;&#x5B50;&#x76EE;&#x5F55;&#x4E2D;&#x7684;CMakeLists.txt&#x6765;&#x521B;&#x5EFA;&#x4EE5;&#x4E0B;&#x5185;&#x5BB9;&#xFF1A;</p>
</div>
<div class="ulist">
<ul>
<li>
<p>sublibrary1 - A static library</p>
</li>
<li>
<p>sublibrary2 - A header only library</p>
</li>
<li>
<p>subbinary - An executable</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The files included in this example are:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ tree
.
&#x251C;&#x2500;&#x2500; CMakeLists.txt
&#x251C;&#x2500;&#x2500; subbinary
&#x2502;&#xA0;&#xA0; &#x251C;&#x2500;&#x2500; CMakeLists.txt
&#x2502;&#xA0;&#xA0; &#x2514;&#x2500;&#x2500; main.cpp
&#x251C;&#x2500;&#x2500; sublibrary1
&#x2502;&#xA0;&#xA0; &#x251C;&#x2500;&#x2500; CMakeLists.txt
&#x2502;&#xA0;&#xA0; &#x251C;&#x2500;&#x2500; include
&#x2502;&#xA0;&#xA0; &#x2502;&#xA0;&#xA0; &#x2514;&#x2500;&#x2500; sublib1
&#x2502;&#xA0;&#xA0; &#x2502;&#xA0;&#xA0;     &#x2514;&#x2500;&#x2500; sublib1.h
&#x2502;&#xA0;&#xA0; &#x2514;&#x2500;&#x2500; src
&#x2502;&#xA0;&#xA0;     &#x2514;&#x2500;&#x2500; sublib1.cpp
&#x2514;&#x2500;&#x2500; sublibrary2
    &#x251C;&#x2500;&#x2500; CMakeLists.txt
    &#x2514;&#x2500;&#x2500; include
        &#x2514;&#x2500;&#x2500; sublib2
            &#x2514;&#x2500;&#x2500; sublib2.h</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="CMakeLists.txt" class="bare">CMakeLists.txt</a> - Top level CMakeLists.txt</p>
</li>
<li>
<p><a href="subbinary/CMakeLists.txt" class="bare">subbinary/CMakeLists.txt</a> - to make the executable</p>
</li>
<li>
<p><a href="subbinary/main.cpp" class="bare">subbinary/main.cpp</a> - source for the executable</p>
</li>
<li>
<p><a href="sublibrary1/CMakeLists.txt" class="bare">sublibrary1/CMakeLists.txt</a> - to make a static library</p>
</li>
<li>
<p><a href="sublibrary1/include/sublib1/sublib1.h" class="bare">sublibrary1/include/sublib1/sublib1.h</a></p>
</li>
<li>
<p><a href="sublibrary1/src/sublib1.cpp" class="bare">sublibrary1/src/sublib1.cpp</a></p>
</li>
<li>
<p><a href="sublibrary2/CMakeLists.txt" class="bare">sublibrary2/CMakeLists.txt</a> - to setup header only library</p>
</li>
<li>
<p><a href="sublibrary2/include/sublib2/sublib2.h" class="bare">sublibrary2/include/sublib2/sublib2.h</a></p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>In this example I have moved the header files to a subfolder under each projects include
directory, while leaving the target include as the root include folder. This is a good idea to prevent
filename clashes because you have to include a file like below:&#x5728;&#x6B64;&#x793A;&#x4F8B;&#x4E2D;&#xFF0C;&#x6211;&#x5DF2;&#x5C06;&#x5934;&#x6587;&#x4EF6;&#x79FB;&#x81F3;&#x6BCF;&#x4E2A;&#x9879;&#x76EE;include&#x76EE;&#x5F55;&#x4E0B;&#x7684;&#x5B50;&#x6587;&#x4EF6;&#x5939;&#xFF0C;&#x800C;&#x5C06;&#x76EE;&#x6807;include&#x4FDD;&#x7559;&#x4E3A;&#x6839;include&#x6587;&#x4EF6;&#x5939;&#x3002; &#x8FD9;&#x662F;&#x9632;&#x6B62;&#x6587;&#x4EF6;&#x540D;&#x51B2;&#x7A81;&#x7684;&#x4E00;&#x4E2A;&#x597D;&#x4E3B;&#x610F;&#xFF0C;&#x56E0;&#x4E3A;&#x60A8;&#x5FC5;&#x987B;&#x5305;&#x62EC;&#x4EE5;&#x4E0B;&#x6587;&#x4EF6;&#xFF1A;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-string">&quot;sublib1/sublib1.h&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This also means that if you install your library for other users the default install location would be
/usr/local/include/sublib1/sublib1.h.&#x8FD9;&#x4E5F;&#x610F;&#x5473;&#x7740;&#xFF0C;&#x5982;&#x679C;&#x60A8;&#x4E3A;&#x5176;&#x4ED6;&#x7528;&#x6237;&#x5B89;&#x88C5;&#x5E93;&#xFF0C;&#x5219;&#x9ED8;&#x8BA4;&#x5B89;&#x88C5;&#x4F4D;&#x7F6E;&#x4E3A;/usr/local/include/sublib1/sublib1.h&#x3002;</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_concepts">Concepts</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_adding_a_sub_directory">Adding a Sub-Directory</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A CMakeLists.txt file can include and call sub-directories which include a CMakeLists.txt
files.CMakeLists.txt&#x6587;&#x4EF6;&#x53EF;&#x4EE5;&#x5305;&#x542B;&#x548C;&#x8C03;&#x7528;&#x5305;&#x542B;CMakeLists.txt&#x6587;&#x4EF6;&#x7684;&#x5B50;&#x76EE;&#x5F55;&#x3002;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cmake" data-lang="cmake"><span class="hljs-keyword">add_subdirectory</span>(sublibrary1)
<span class="hljs-keyword">add_subdirectory</span>(sublibrary2)
<span class="hljs-keyword">add_subdirectory</span>(subbinary)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_referencing_sub_project_directories">Referencing Sub-Project Directories&#x5F15;&#x7528;&#x5B50;&#x9879;&#x76EE;&#x76EE;&#x5F55;</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When a project is created using the <code>project()</code> command, CMake will automatically
create a number of variables which can be used to reference details about the project.
These variables can then be used by other sub-projects or the main project. For exampe,
to reference the source directory for a different project you can use.
&#x4F7F;&#x7528;project&#xFF08;&#xFF09;&#x547D;&#x4EE4;&#x521B;&#x5EFA;&#x9879;&#x76EE;&#x65F6;&#xFF0C;CMake&#x5C06;&#x81EA;&#x52A8;&#x521B;&#x5EFA;&#x8BB8;&#x591A;&#x53D8;&#x91CF;&#xFF0C;&#x8FD9;&#x4E9B;&#x53D8;&#x91CF;&#x53EF;&#x7528;&#x4E8E;&#x5F15;&#x7528;&#x6709;&#x5173;&#x8BE5;&#x9879;&#x76EE;&#x7684;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#x3002; &#x8FD9;&#x4E9B;&#x53D8;&#x91CF;&#x7136;&#x540E;&#x53EF;&#x4EE5;&#x7531;&#x5176;&#x4ED6;&#x5B50;&#x9879;&#x76EE;&#x6216;&#x4E3B;&#x9879;&#x76EE;&#x4F7F;&#x7528;&#x3002; &#x4F8B;&#x5982;&#xFF0C;&#x8981;&#x5F15;&#x7528;&#x60A8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x7684;&#x5176;&#x4ED6;&#x9879;&#x76EE;&#x7684;&#x6E90;&#x76EE;&#x5F55;&#x3002;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cmake" data-lang="cmake">    <span class="hljs-variable">${sublibrary1_SOURCE_DIR}</span>
    <span class="hljs-variable">${sublibrary2_SOURCE_DIR}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The variables created by CMake include:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Variable</th>
<th class="tableblock halign-left valign-top">Info</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PROJECT_NAME</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the project set by the current <code>project()</code>.&#x5F53;&#x524D;project&#xFF08;&#xFF09;&#x8BBE;&#x7F6E;&#x7684;&#x9879;&#x76EE;&#x7684;&#x540D;&#x79F0;&#x3002;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CMAKE_PROJECT_NAME</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the name of the first project set by the <code>project()</code>
command, i.e. the top level project.&#x7531;project&#xFF08;&#xFF09;&#x547D;&#x4EE4;&#x8BBE;&#x7F6E;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x9879;&#x76EE;&#x7684;&#x540D;&#x79F0;&#xFF0C;&#x5373;&#x9876;&#x5C42;&#x9879;&#x76EE;&#x3002;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PROJECT_SOURCE_DIR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The source director of the current project.&#x5F53;&#x524D;&#x9879;&#x76EE;&#x7684;&#x6E90;&#x6587;&#x4EF6;&#x76EE;&#x5F55;&#x3002;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PROJECT_BINARY_DIR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The build directory for the current project.&#x5F53;&#x524D;&#x9879;&#x76EE;&#x7684;&#x6784;&#x5EFA;&#x76EE;&#x5F55;&#x3002;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name_SOURCE_DIR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The source directory of the project called &quot;name&quot;.
In this example the source directories created would be &#x9879;&#x76EE;&#x7684;&#x6E90;&#x6587;&#x4EF6;&#x76EE;&#x5F55;&#x79F0;&#x4E3A;&#x201C;name&#x201D;&#x3002; &#x5728;&#x6B64;&#x793A;&#x4F8B;&#x4E2D;&#xFF0C;&#x521B;&#x5EFA;&#x7684;&#x6E90;&#x76EE;&#x5F55;&#x4E3A;
<code>sublibrary1_SOURCE_DIR</code>,
<code>sublibrary2_SOURCE_DIR</code>, and <code>subbinary_SOURCE_DIR</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name_BINARY_DIR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The binary directory of the project called &quot;name&quot;.
In this example the binary directories created would be <code>sublibrary1_BINARY_DIR</code>,
<code>sublibrary2_BINARY_DIR</code>, and <code>subbinary_BINARY_DIR</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_header_only_libraries">Header only Libraries</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you have a library that is created as a header only library, cmake supports the INTERFACE
target to allow creating a target without any build output. More details can be found from
<a href="https://cmake.org/cmake/help/v3.4/command/add_library.html#interface-libraries" target="_blank">here</a>
&#x5982;&#x679C;&#x60A8;&#x6709;&#x4E00;&#x4E2A;&#x5E93;&#x88AB;&#x521B;&#x5EFA;&#x4E3A;&#x4EC5;&#x5934;&#x6587;&#x4EF6;&#x7684;&#x5E93;&#xFF0C;&#x5219;cmake&#x652F;&#x6301;INTERFACE&#x76EE;&#x6807;&#xFF0C;&#x4EE5;&#x5141;&#x8BB8;&#x521B;&#x5EFA;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x6784;&#x5EFA;&#x8F93;&#x51FA;&#x7684;&#x76EE;&#x6807;&#x3002; &#x53EF;&#x4EE5;&#x4ECE;&#x8FD9;&#x91CC;&#x627E;&#x5230;&#x66F4;&#x591A;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cmake" data-lang="cmake"><span class="hljs-keyword">add_library</span>(<span class="hljs-variable">${PROJECT_NAME}</span> INTERFACE)</code></pre>
</div>
</div>
<div class="paragraph">
<p>When creating the target you can also include directories for that target using
the INTERFACE scope. The INTERFACE scope is use to make target requirements that are used in any Libraries
that link this target but not in the compilation of the target itself.&#x521B;&#x5EFA;&#x76EE;&#x6807;&#x65F6;&#xFF0C;&#x60A8;&#x8FD8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;INTERFACE&#x8303;&#x56F4;&#x5305;&#x542B;&#x8BE5;&#x76EE;&#x6807;&#x7684;&#x76EE;&#x5F55;&#x3002; INTERFACE&#x8303;&#x56F4;&#x7528;&#x4E8E;&#x5236;&#x5B9A;&#x5728;&#x94FE;&#x63A5;&#x6B64;&#x76EE;&#x6807;&#x7684;&#x4EFB;&#x4F55;&#x5E93;&#x4E2D;&#x4F7F;&#x7528;&#x7684;&#x76EE;&#x6807;&#x9700;&#x6C42;&#xFF0C;&#x4F46;&#x5728;&#x76EE;&#x6807;&#x672C;&#x8EAB;&#x7684;&#x7F16;&#x8BD1;&#x4E2D;&#x4E0D;&#x4F7F;&#x7528;&#x3002;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cmake" data-lang="cmake">target_include_directories(<span class="hljs-variable">${PROJECT_NAME}</span>
    INTERFACE
        <span class="hljs-variable">${PROJECT_SOURCE_DIR}</span>/<span class="hljs-keyword">include</span>
)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_referencing_libraries_from_sub_projects">Referencing Libraries from Sub-Projects&#x5F15;&#x7528;&#x5B50;&#x9879;&#x76EE;&#x4E2D;&#x7684;&#x5E93;</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If a sub-project creates a library, it can be referenced by other projects by
calling the name of the project in the <code>target_link_libraries()</code> command. This
means that you don&#x2019;t have to reference the full path of the new library and it
is added as a dependency.
&#x5982;&#x679C;&#x5B50;&#x9879;&#x76EE;&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;&#x5E93;&#xFF0C;&#x5219;&#x5176;&#x4ED6;&#x9879;&#x76EE;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5728;target_link_libraries&#xFF08;&#xFF09;&#x547D;&#x4EE4;&#x4E2D;&#x8C03;&#x7528;&#x8BE5;&#x9879;&#x76EE;&#x7684;&#x540D;&#x79F0;&#x6765;&#x5F15;&#x7528;&#x8BE5;&#x5E93;&#x3002; &#x8FD9;&#x610F;&#x5473;&#x7740;&#x60A8;&#x4E0D;&#x5FC5;&#x5F15;&#x7528;&#x65B0;&#x5E93;&#x7684;&#x5B8C;&#x6574;&#x8DEF;&#x5F84;&#xFF0C;&#x800C;&#x662F;&#x5C06;&#x5176;&#x6DFB;&#x52A0;&#x4E3A;&#x4F9D;&#x8D56;&#x9879;&#x3002;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cmake" data-lang="cmake"><span class="hljs-keyword">target_link_libraries</span>(subbinary
    PUBLIC
        sublibrary1
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you can create an alias target which allows you to reference the
target in read only contexts.&#x6216;&#x8005;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x522B;&#x540D;&#x76EE;&#x6807;&#xFF0C;&#x8BE5;&#x76EE;&#x6807;&#x5141;&#x8BB8;&#x60A8;&#x5728;&#x53EA;&#x8BFB;&#x4E0A;&#x4E0B;&#x6587;&#x4E2D;&#x5F15;&#x7528;&#x8BE5;&#x76EE;&#x6807;&#x3002;</p>
</div>
<div class="paragraph">
<p>To create an alias target run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cmake" data-lang="cmake"><span class="hljs-keyword">add_library</span>(sublibrary2)
<span class="hljs-keyword">add_library</span>(sub::lib2 ALIAS sublibrary2)</code></pre>
</div>
</div>
<div class="paragraph">
<p>To reference the alias, just it as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cmake" data-lang="cmake"><span class="hljs-keyword">target_link_libraries</span>(subbinary
    sub::lib2
)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_include_directories_from_sub_projects">Include directories from sub-projects&#x5305;&#x542B;&#x5B50;&#x9879;&#x76EE;&#x4E2D;&#x7684;&#x76EE;&#x5F55;</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When adding the libraries from the sub-projects, starting from cmake v3, there is
no need to add the projects include directories in the include directories of the
binary using them.&#x4ECE;cmake v3&#x5F00;&#x59CB;&#x4ECE;&#x5B50;&#x9879;&#x76EE;&#x6DFB;&#x52A0;&#x5E93;&#x65F6;&#xFF0C;&#x65E0;&#x9700;&#x5C06;&#x9879;&#x76EE;include&#x76EE;&#x5F55;&#x6DFB;&#x52A0;&#x5230;&#x4E8C;&#x8FDB;&#x5236;&#x6587;&#x4EF6;&#x7684;include&#x76EE;&#x5F55;&#x4E2D;&#x3002;</p>
</div>
<div class="paragraph">
<p>This is controlled by the scope in the <code>target_include_directories()</code> command when creating
the libraries. In this example because the subbinary executable links the sublibrary1
and sublibrary2 libraries it will automatically include the <code>${sublibrary1_SOURCE_DIR}/inc</code>
and <code>${sublibrary2_SOURCE_DIR}/inc</code> folders as they are exported with the
 PUBLIC and INTERFACE scopes of the libraries.&#x521B;&#x5EFA;&#x5E93;&#x65F6;&#xFF0C;&#x8FD9;&#x7531;target_include_directories&#xFF08;&#xFF09;&#x547D;&#x4EE4;&#x4E2D;&#x7684;&#x4F5C;&#x7528;&#x57DF;&#x63A7;&#x5236;&#x3002; &#x5728;&#x6B64;&#x793A;&#x4F8B;&#x4E2D;&#xFF0C;&#x56E0;&#x4E3A;&#x5B50;&#x4E8C;&#x8FDB;&#x5236;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x94FE;&#x63A5;&#x4E86;sublibrary1&#x548C;sublibrary2&#x5E93;&#xFF0C;&#x6240;&#x4EE5;&#x5F53;&#x5B83;&#x4EEC;&#x4E0E;&#x5E93;&#x7684;PUBLIC&#x548C;INTERFACE&#x8303;&#x56F4;&#x4E00;&#x8D77;&#x5BFC;&#x51FA;&#x65F6;&#xFF0C;&#x5B83;&#x5C06;&#x81EA;&#x52A8;&#x5305;&#x542B;$ {sublibrary1_SOURCE_DIR} / inc&#x548C;$ {sublibrary2_SOURCE_DIR} / inc&#x6587;&#x4EF6;&#x5939;&#x3002;</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_building_the_example">Building the example</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ mkdir build

$ <span class="hljs-built_in">cd</span> build/

$ cmake ..
-- The C compiler identification is GNU 4.8.4
-- The CXX compiler identification is GNU 4.8.4
-- Check <span class="hljs-keyword">for</span> working C compiler: /usr/bin/cc
-- Check <span class="hljs-keyword">for</span> working C compiler: /usr/bin/cc -- works
-- Detecting C compiler ABI info
-- Detecting C compiler ABI info - <span class="hljs-keyword">done</span>
-- Check <span class="hljs-keyword">for</span> working CXX compiler: /usr/bin/c++
-- Check <span class="hljs-keyword">for</span> working CXX compiler: /usr/bin/c++ -- works
-- Detecting CXX compiler ABI info
-- Detecting CXX compiler ABI info - <span class="hljs-keyword">done</span>
-- Configuring <span class="hljs-keyword">done</span>
-- Generating <span class="hljs-keyword">done</span>
-- Build files have been written to: /home/matrim/workspace/cmake-examples/02-sub-projects/A-basic/build

$ make
Scanning dependencies of target sublibrary1
[ 50%] Building CXX object sublibrary1/CMakeFiles/sublibrary1.dir/src/sublib1.cpp.o
Linking CXX static library libsublibrary1.a
[ 50%] Built target sublibrary1
Scanning dependencies of target subbinary
[100%] Building CXX object subbinary/CMakeFiles/subbinary.dir/main.cpp.o
Linking CXX executable subbinary
[100%] Built target subbinary</code></pre>
</div>
</div>
</div>
</div>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../" class="navigation navigation-prev navigation-unique" aria-label="Previous page: 介绍">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"2.1 使用子工程CMake","level":"1.3.2","depth":2,"next":{"title":"3  生成源代码","level":"1.4","depth":1,"ref":"","articles":[{"title":"介绍","level":"1.4.1","depth":2,"path":"03-code-generation/README.adoc","ref":"03-code-generation/README.adoc","articles":[]},{"title":"3.1  配置文件","level":"1.4.2","depth":2,"path":"03-code-generation/configure-files/README.adoc","ref":"03-code-generation/configure-files/README.adoc","articles":[]},{"title":"3.2  protobuf","level":"1.4.3","depth":2,"path":"03-code-generation/protobuf/README.adoc","ref":"03-code-generation/protobuf/README.adoc","articles":[]}]},"previous":{"title":"介绍","level":"1.3.1","depth":2,"path":"02-sub-projects/README.adoc","ref":"02-sub-projects/README.adoc","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["github-buttons","livereload"],"pluginsConfig":{"github-buttons":{"buttons":[{"user":"SFUMECJF","repo":"cmake-examples-Chinese","type":"star","size":"large"},{"user":"SFUMECJF","type":"follow","width":"230","count":false}]},"livereload":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"02-sub-projects/A-basic/README.adoc","mtime":"2020-11-22T08:45:24.450Z","type":"asciidoc"},"gitbook":{"version":"3.2.3","time":"2020-11-22T09:33:28.017Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-github-buttons/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

